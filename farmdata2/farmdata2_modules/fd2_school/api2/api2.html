<html>
<body>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="main.css">
    <style>
        [v-cloak] {
          display:none;
        }

        table, th, td { 
          border: 1px solid black; 
          border-collapse: collapse; 
          } 

    </style> 
</head>

<h1>Harvest Report</h1>
<p><FONT COLOR="GREY"> This page is a <i>mockup</i> of a simplfied Harvest Report</FONT></p>
<div id="pageInfo">
    <input type="text" value="Title:" v-model="rHeader"/>
    <body>
    <br>
    
    <label for="crop">Crop:</label> 
    <select id="crop" v-model="selectedCrop"> 
      <option v-for="crop in cropNames" :value="crop">{{ crop }}</option>
    </select>

    <br>
    <label for="field">Field:</label>
    <select id="field" v-model="selectedArea"> 
      <option v-for="area in areas" :value="area">{{ area }}</option>
    </select>
    <br>
    <label for="start">Start date:</label>

    <div id="startDate">
    <input type="date" id="start" min="minStartDate" :max="minEndDate" v-model="rStartDate"/>        
    </div>

    <br>
    <label for="end">End date:</label>
    <input type="date" id="end" :min="maxStartDate" max="maxEndDate" v-model="rEndDate"/>
    <br>
    <button class="btn btn-primary" @click="saveReport" type="submit">Generate Report</button>
    
    <hr style="width:33%;margin-left:0">
    <div id="rHeader">
    <h1>{{ (rHeader!="") ? rHeader:"Mock Harvest Report"}}</h1>
    <p><FONT COLOR="GREY"> Details:</FONT></p>
    <ul>
      <li><b>Farm:</b> {{ farm }}</li>
      <li><b>User:</b> {{ user }}</li>
      <li><b>Language:</b> {{ language }}</li>
<br>
      <li><b>Start:</b> {{ rStartDate }}</li>
      <li><b>End:</b> {{ rEndDate }}</li>
      <li><b>Crop:</b> Kale</li>
    </ul>
    </div>
    <h3 v-if="tableData.length === 0"> No records to display </h3>
    <table v-if="tableData.length != 0"> 
      <tr> 
        <th>Row</th>
        <th>Date</th> 
        <th>Area</th> 
        <th>Crop</th> 
        <th>Yield</th> 
        <th>Units</th> 
      </tr> 
      <tr v-for="(t,index) in tableData"> 
        <td>{{ t.index }}</td> 
        <td>{{ t.date }}</td> 
        <td>{{ t.area }}</td> 
        <td>{{ t.crop }}</td> 
        <td>{{ t.yield }}</td> 
        <td>{{ t.units }}</td> 
      </tr> 
    </table>
</div>



</body>
<script>
  var pageInfo = new Vue({
      el: '#pageInfo',
      data: {
          rHeader: "",
          rStartDate: "2020-05-05",
          minStartDate: "2014-01-01",
          maxStartDate: "2022-01-01",
          rEndDate:"2020-05-15",
          minEndDate:"2020-05-05",
          maxEndDate:"2022-01-01",
          rStartTimestamp:"",
          rEndTimestamp:"",
          APIAllPageData:[
          ],

          idToCropMap: new Map(),
          
          selectedCrop: "",
          
          areas: [
            "All",
            "Chuau-1",
            "SQ7",
          ],
          selectedArea: "",

          farm: "",
          user: "",
          language: "",

          newData:'',

          rowNum: 1,

          tableData: [
            
          ]

        },

        created() {
	        getIDToCropMap()
                .then((theMap) => {
                    this.idToCropMap=theMap
            })

            .catch((err) => {
                console.log("error IDToCropMap")
            })
        },

        computed: {
            cropNames(){
                return Array.from(this.idToCropMap.values());
            },
        },

        methods: {
          saveReport: function(){
              axios.get('/farm.json')
              .then ((response) => {
                this.farm=response.data.name;
                this.user=response.data.user.name;
                this.language=response.data.languages.en.name;
              })
              .catch ((error) => {
                console.log("Error Occurred")
                console.log(error)
              })


              let rStartTimestamp = dayjs(this.rStartDate).unix();
              let rEndTimestamp = dayjs(this.rEndDate).unix();
              console.log(rStartTimestamp);
              console.log(rEndTimestamp);
              console.log("/log.json?type=farm_harvest&timestamp[ge]=" + rStartTimestamp 
                                  + "&timestamp[le]=" + rEndTimestamp);

              this.tableData.push({index: this.rowNum,date:"2018-05-01", area: "Orion-3", crop: "Kale",yield:"12",units: "Bunches"}),     
              this.rowNum=this.rowNum+1;
              
              getAllPages("/log.json?type=farm_harvest&timestamp[ge]=" + rStartTimestamp + "&timestamp[le]=" + rEndTimestamp)
              .then((res) => {
                this.APIAllPageData=res
              })
              .catch((err) => {
                console.log("Error Occurred")
                console.log(err)
              })

            },  
      } 
  });
  Vue.config.devtools = true;
</script>
</body>
</html>

