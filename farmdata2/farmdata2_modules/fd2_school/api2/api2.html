<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vue Sub tab</title>
    <style>
        [v-cloak] {
            display: none;
        }
    </style>
    <script src="https://unpkg.com/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.21.4"></script>
</head>
<body>
    <div id="app">
        <h1>{{ header ? header : "Mock Harvest Report" }}</h1>
        <p>This page is a <i>mockup</i> of a simplified harvest report.</p>
        <input type="text" id="title" name="title" value="My Sample Harvest Report"/>
        <br><br>

        <form>
            <label for="startDate">Start Date:</label>
            <input type="date" id="startDate" :max="endDate" v-model="startDate">

            <label for="endDate">End Date:</label>
            <input type="date" id="endDate" :min="startDate" v-model="endDate">
            <br><br>

            <label for="crop">Crops:</label>
            <select id="crop" name="crop" v-model="selectedCrop">
                <option v-for="crop in crops" :value="crop.id">{{ crop.name }}</option>
            </select>
            <label for="area">Area:</label>
            <select id="area" name="area" v-model="selectedArea">
                <option v-for="area in areas" :value="area">{{ area }}</option>
            </select>
        </form>
        <button @click="generateReport">Generate Report</button>

        <hr>
        <div>
            <h1>My Sample Harvest Report</h1>
            <p>Details:</p>
            <ul>
                <li><strong>Farm:</strong>{{ farmName }}</li>
                <li><strong>User:</strong>{{ userName }}</li>
                <li><strong>Language:</strong>{{ userLanguage }}</li>
            </ul>
            <br>
            <ul>
                <li><strong>Start:</strong>{{ startDate }}</li>
                <li><strong>End:</strong>{{ endDate }}</li>
                <li><strong>Crop:</strong>{{ selectedCrop }}</li>
            </ul>
            <table border="1" v-if="harvestLogs.length > 0">
                <tr>
                    <th>Row</th>
                    <th>Date</th>
                    <th>Area</th>
                    <th>Crop</th>
                    <th>Yield</th>
                    <th>Units</th>
                    <th>Delete</th>
                </tr>
                <tr v-for="(log, index) in harvestLogs" :key="log.date">
                    <td>{{ index + 1 }}</td>
                    <td>{{ log.date }}</td>
                    <td>{{ log.area }}</td>
                    <td>{{ getCropName(log.crop) }}</td>
                    <td>{{ log.yield }}</td>
                    <td>{{ log.units }}</td>
                    <td>
                        <button @click="deleteLog(index)">Delete</button>
                    </td>
                </tr>
            </table>
            <p v-else>No recorded data found.</p>
        </div>
    </div>

    <script>
        var harvestRepo = new Vue({
            created() {
                console.log("HarvestReport Vue instance created!");
                getCropToIDMap()
                    .then((theMap) => {
                        this.idToCropMap = theMap;
                    })
                    .catch((error) => {
                        console.error("Error fetching crops");
                    })
            },
                computed: {
                    cropNamesArray (){
                        return Array.from(this.idToCropMap.keys())
                    },
                },

            el: '#app',
            data: {
                header: "Harvest Report",
                startDate: '',
                endDate: '',
                selectedCrop: '',
                selectedArea: '',
                // crops: [],
                areas: ['All', 'Chuau-1', 'SQ7'],
                farmName: '',
                userName: '',
                userLanguage: '',
                harvestLogs: [],
                idToCropMap: new Map(),
            },

            methods: {
                generateReport: function() {
                    axios.get('/farm.json')
                        .then(function (response) {

                            this.farmName = response.data.name;
                            this.userName = response.data.user.name;
                            this.userLanguage = response.data.user.language;

                            // var newHarvestLog = {
                            //     date: '2021-08-20',
                            //     area: 'SQ7',
                            //     crop: 'Broccoli', // Use crop ID here
                            //     yield: 20,
                            //     units: 'Pounds'
                            // };

                            this.harvestLogs.push(newHarvestLog);
                        })
                        .catch(function (error){
                            console.log("Error Occurred");
                            console.log(error);
                        });
                },
                deleteLog: function(index) {
                    // Remove the log at the given index
                    this.harvestLogs.splice(index, 1);
                },
                getCropName: function(cropId) {
                    return this.idToCropMap.get(cropId) || 'Unknown Crop';
                }
            }
        });

        Vue.config.devtools = true;
    </script>
</body>
</html>
