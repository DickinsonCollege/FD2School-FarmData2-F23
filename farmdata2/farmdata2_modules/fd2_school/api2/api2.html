<h1>Harvest Report</h1>
<p>This page is a <i>mockup</i> of a simplified harvest report</p>
<div id = Vue2 v-cloak>
    <label for="title">Title</label>
    <input type="text" v-model="rptTitle">
    <br><br>
    
    <label for="start">Start:</label>
    <input type="date" v-model = "rptStartDate" :max="rptEndDate"/>
    
    <label for="end">End:</label>
    <input type="date" v-model = "rptEndDate" :min="rptStartDate"/> 
    
    <br><br>
    <label for="rptCrop">Crop</label> 
    <select  v-model="rptCrop">
        <option v-for="crop in cropNames">{{crop}}</option>
    </select>

    <label for="rptField">Area</label>
    <select v-model="rptField">
        <option v-for="field in fields">{{field}}</option>
    </select>
    
    <br><br>
    <button type="button" v-on:click="savehstLogs">Generate Report</button>
    
    <hr>
    <h1>{{rptTitle==""? "Mock Harvest Report":rptTitle}}</h1>


<p>
    Details:
    <ul>
        <li><b>Farm</b>:{{farm}}</li>
        <li><b>User</b>:{{user}}</li>
        <li><b>Language</b>:{{language}}</li>
        <br> 
        <li><b>Start</b>:{{rptStartDate}}</li>
        <li><b>End</b>:{{rptEndDate}}</li>
        <li><b>Crop</b>:{{rptCrop}}</li>
     </ul>
    </p>

    <div v-if="hstLogs.length > 0">      
        <table border="1">
            <tr>
                <th>Row</th>
                <th>Date</th>
                <th>Area</th>
                <th>Crop</th>
                <th>Yield</th>
                <th>Units</th>
            </tr>
            <tr v-for="log in hstLogs">
                <td>{{log.row}}</td>
                <td>{{log.date}}</td>
                <td>{{log.area}}</td>
                <td>{{log.crop}}</td>
                <td>{{log.yield}}</td>
                <td>{{log.units}}</td>
            </tr>
        </table>


    </div>
    <div v-else>
        <p>No Matching Records<p>
    </div>

    
        
       
</div>

<script>
    var Vue2 = new Vue({
        el:"#Vue2",
        created(){
            console.log("HarvestReport Vue instance created!")
            getIDToCropMap()
            .then((theMap) => {
                this.idToCropMap = theMap
            })
            .catch((err) => {
                console.log("Error Occurred")
                console.log(err)

            })
        },
        data: {
            rptTitle: "My Sample Harvest Report",
            rptStartDate: "2020-05-05",
            rptEndDate: "2020-05-15",
            rptCrop: "Kale",
            rptField: "All",
            fields: ["All", "Chuau-1", "SQ7"],
            hstLogs: [],
            farm: "",
            user: "",
            language: "",
            idToCropMap: new Map(),
        },
        computed:{
            cropNames(){
                return Array.from(this.idToCropMap.values())
            }
        }
        ,
        methods: {
            
            savehstLogs: function(){
                axios.get("/farm.json")
                .then ((response) => {
                    this.farm = response.data.name
                    this.user = response.data.user.name
                    this.language = response.data.languages.en.name


                })
                .catch((error) => {
                    console.log("Error Occurred")
                    console.log(error)

                })

                this.hstLogs.push({row:this.hstLogs.length + 1,date:"2018-05-01", area:"Orion-3", crop:"Kale", yield:"12", units:"Bunches"});
            }
        }
    })

    Vue.config.devtools = true;
</script>



