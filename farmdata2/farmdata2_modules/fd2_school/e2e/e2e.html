<h1 data-cy="page-header">Harvest Report</h1>
    
        <head>
           <style>
                [v-cloak]{
                    display: none;
                }
                </style>      
        </head>
    
        <body>
            
    
            <p>
                This page is a <i>mockup</i> of a simplified harvest report.
            </p>     
        
    <div id="HarvestHeader" v-cloak>
                
                <label for="comment">Title:</label>
                <input type="text"  v-model="header" />
                
            </br>
                
    
        </br>
       
        <label for="crop">Crop: </label>
        <select id="crop" name="crop" v-model ="crop">
            
            <option v-for="crop in cropNames"> {{ crop }}</option>
          </select>  
          
        
    
        <label for="field">Area: </label>
        <select id="field" name="field" v-mdoel="area">
        <option v-for="area in areas"> {{ area }}</option>
            
          </select> 
        
        </br>
        </br>
    
        <label for="start">Start date:</label>
        

        <input data-cy="start-date" type="date" id="start" min="minStartDate" :max="minEndDate" v-model="sStartDate"/>  
    
        <label for="end">End date:</label>
        
        
        <input data-cy="end-date" type="date" id="end" :min="maxStartDate" max="maxEndDate" v-model="eEndDate" />

        </br>
        </br>
    
        <button class="btn btn-primary" @click="saveReport" type="submit">Generate Report</button>
        
    
    <hr/>
                <h1>{{ (header == '') ? 'Mock Harvest Report':header}}</h1>
            
            
            
        
            
        
        
            
            <p>
                Details:
                </p>
                <ul>
                    <li><strong>Farm: </strong>{{ Farm }}</li>
                    <li><strong>User: </strong>{{ User}}</li>
                    <li><strong>Language: </strong>{{ Language }}</li>
                </br>
                    <li><strong>Start: </strong>{{ start }}</li>
                    <li><strong>End: </strong>{{ end }}</li>
                    <li><strong>Crop: </strong>{{ crop }}</li>
    
                    </ul>
                  
            
    
            <head>
                <style>
                    th {
                        font-weight: bold;
                    }
                    
                    table, th, td {
                        border: 1px solid black;
                    }
                </style>
            </head>
            
                <h3 v-if="harvestReportRows.length === 0"> Nothing to display </h3>
                <table v-if="harvestReportRows.length != 0"> 

                    <tr>
                        <th>Row</th>
                        <th>Date</th>
                        <th>Area</th>
                        <th>Crop</th>
                        <th>Yield</th>
                        <th>Units</th>
                    </tr>
                    <tr v-for="(t,index) in harvestReportRows">
                        <td>{{ index+1 }}</td>
                        <td>{{ t.date }}</td>
                        <td>{{ t.area }}</td>
                        <td>{{ t.crop }}</td>
                        <td>{{ t.yield }}</td>
                        <td>{{ t.units }}</td>
                    </tr>
                    
                   
                </table>
    </div>
                <script>
                    var Vues = new Vue({
                        el: '#HarvestHeader',
                        created() {
	                        console.log("HarvestReport Vue instance created!")
                            getIDToCropMap()
                                .then((theMap) => {
                                    this.idToCropMap = theMap;
                                })
                                .catch((err) => {
                                    console.log("Error occurred!")
                                })
                        },
                        data: {
                            header: 'My Sample Harvest Report',
                            start: '2020-05-01',
                            end: '2020-05-15',
                            crop: '',
                            idToCropMap: new Map(),
                            area: 'All',
                            areas: [
                                'All',
                                'SQ7',
                                'Chuau-1'
                            ],
                            newData: '',
                            table: [
                                
                            ],
                            sStartDate: "2020-05-05",
                            minStartDate: "2014-01-01",
                            maxStartDate: "2022-01-01",
                            eEndDate:"2020-05-15",
                            minEndDate:"2020-05-05",
                            maxEndDate:"2022-01-01",
                            Farm:'',
                            User:'',
                            Language:'',
                            sStartTimestamp:"",
                            eEndTimestamp:"",
                            APIAllPageData:[
                            ],
                            index:0,
                        
                        
                        },
                        computed: {
                            cropNames () {
                                return Array.from(this.idToCropMap.values());
                            },
                        
                            harvestReportRows() {
                                let tableRows = []
                                    for(let log of this.APIAllPageData) {
                                        if(this.idToCropMap.get(log.data.crop_tid) === this.crop) {   
                                            let tableRow = {
                                                date: dayjs.unix(log.timestamp).format('MM/DD/YYYY'),
                                                area: log.area[0].name,
                                                yield: log.quantity[0].value,
                                                units: log.quantity[0].unit.name,
                                                crop: this.idToCropMap.get(log.data.crop_tid)
                                            }
                                            tableRows.push(tableRow)
                                    }
                                }
                                return tableRows
                            },
                                    
                        },
                        methods: {
                            saveReport: function() {
                                axios.get('/farm.json')
                                .then ((response) => {
                                    console.log("Got Response")
                                    console.log(response)
                                    this.farm=response.data.name;
                                    this.user=response.data.user.name;
                                    this.language=response.data.languages.en.name;
                                })
                                .catch ((error) => {
                                    console.log("Error Occurred")
                                    console.log(error)
                                })

                                let sStartTimestamp = dayjs(this.sStartDate).unix();
                                let eEndTimestamp = dayjs(this.eEndDate).unix();  
                                this.rowNumber=this.rowNumber+1;
                                this.Farm = 'Sample Farm';
                                this.User = 'manager1';
                                this.Language = 'English';

                                getAllPages("/log.json?type=farm_harvest&timestamp[ge]=" + sStartTimestamp + "&timestamp[le]=" + eEndTimestamp)
                                .then((res) => {
                                    this.APIAllPageData=res
                                })
                                .catch((err) => {
                                    console.log("Error Occurred")
                                    console.log(err)
                                })

                                }

                            }
                    
                    })
                    Vue.config.devtools = true;
                </script>
    
            </body>